## 绑定Dokcer容器到主机指定网卡的方法

如果你的主机有多块网卡，你可能会需要把 Docker 容器绑定到指定网卡，以使容器内的所有网络请求都经过该指定网卡发送至外网。

不幸的是，Docker 并没有直接提供实现该需求的方法。不过，通过 iptables 可以轻松搞定。

**一刀切**

假设你的主机上有两块网卡：一块网卡的 IP 地址是 10.0.0.100 ；另一块网卡的 IP 地址是 192.168.1.103 。你想让这台主机上的 Docker 容器内的所有服务都走第二块网卡进出外网。

先给出答案再解释：



复制代码代码如下:

```bash
iptables -t nat -I POSTROUTING -p all -s 172.17.0.0/16 -j SNAT --to-source 192.168.1.103
```



上面的 iptables 命令创建了一条源地址转换（ SNAT ）规则，把所有来自 172.17.0.0/16 网段且即将流出本主机的数据包的源 IP 地址都修改为 192.168.1.103 。

对于 192.168.1.103 我们知道它是主机第二块网卡的 IP 地址。而 172.17.0.0/16 是从哪来的呢？

简单来说，在主机上运行 Docker 时，它会在主机上创建一个名为 docker0 的网桥，其 IP 地址为 172.17.0.1 ，网段为 172.17.0.0/16 。默认情况下，Docker 会为所有容器从该网段分配一个 IP 地址。

更详细的说明，可以参考这篇《单 Host 下 Docker 的默认网络配置》 。

所有 Docker 容器的 IP 地址都是在 172.17.0.0/16 网段，那么，上边的 iptables 命令创建的规则就是把所有来自 Docker 容器的且即将流出本主机的数据包的源 IP 地址都修改为本主机的第二块网卡的 IP 地址，即 192.168.1.103 。

这样，就实现了我们需求的『出』这半部分。

而『进』那半部分需求的实现也很简单，只需在 docker run 的时候通过 -p 参数指定主机 IP 即可，如：

```
docker run -p 192.168.1.103:80:80 ...
```

