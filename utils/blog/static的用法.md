

### static的用法

static 是 C/C++ 中很常用的修饰符，它被用来控制变量的**存储方式**和**可见性**。

#### 1. static 的引入

我们知道在函数内部定义的**变量**，当程序执行到它的定义处时，编译器为它在**栈**上分配空间，函数在栈上分配的空间在此函数执行结束时会释放掉，这样就产生了一个问题: 如果想将函数中此变量的值保存至下一次调用时，如何实现？ 最容易想到的方法是定义为全局的变量，但定义一个全局变量有许多缺点，最明显的缺点是**破坏了此变量的访问范围（使得在此函数中定义的变量，不仅仅只受此函数控制）**。static 关键字则可以很好的解决这个问题。另外，在 C++ 中，需要一个数据对象为整个类而非某个对象服务,同时又力求不破坏类的封装性,即要求此**成员隐藏在类的内部，对外不可见时**，可将其定义为静态数据。



#### 2. 静态数据的存储

**全局（静态）存储区**：分为 DATA 段和 BSS 段。**DATA 段（全局初始化区）**存放初始化的全局变量和静态变量；**BSS 段（全局未初始化区）**存放未初始化的全局变量和静态变量。程序运行结束时自动释放。其中BBS段在程序执行之前会被系统自动清0，

内存分布图：

**代码区：**			存储代码
**全局数据区：**	static 数据、全局变量、const 常量
**堆区：**			   **new** 出来的动态数据， 需手动释放。若忘记释放会造成**内存泄漏**，程序结束时由操作系统回收。
**栈区：**			   函数内部变量，由IDE自动分配，结束时自动释放。



#### 3. 在 C/C++ 中static的作用

（1）在修饰变量的时候，static 修饰的静态局部变量只执行**初始化一次**，而且延长了局部变量的生命周期，**直到程序运行结束**以后才释放。

（2）static 修饰全局变量的时候，这个全局变量只能在**本文件中访问**，不能在其它文件中访问，即便是 **extern 外部声明也不可以**。

（3）static 修饰一个函数，则这个函数的只能在**本文件中调用**，不能被其他文件调用。static 修饰的变量存放在全局数据区的静态变量区，包括全局静态变量和局部静态变量，都在全局数据区分配内存。初始化的时候自动初始化为 0。

（4）**不想被释放**的时候，可以使用static修饰。比如修饰函数中存放在栈空间的数组。如果不想让这个数组在函数调用结束释放可以使用 static 修饰。

（5）考虑到**数据安全性**（当程序想要使用全局变量的时候应该**先考虑使用 static**）。



#### 4. 类中 static 用法

（1）可以通过类名来调用类的静态成员函数/变量；不能通过类名来调用类的非静态成员函数/变量。

（2）类的对象可以使用静态成员函数和非静态成员函数。

（3）静态成员函数中不能引用非静态成员，反之可以。

（4）静态成员变量使用前必须先初始化(如 **int MyClass::m_nNumber = 0;**)，否则会出错。

（5）非静态成员函数有 this 指针，而静态成员函数没有 this 指针。

参考：

[1] [菜鸟教程](https://www.runoob.com/w3cnote/cpp-static-usage.html)

[2] [博客园](https://www.cnblogs.com/33debug/p/7223869.html)